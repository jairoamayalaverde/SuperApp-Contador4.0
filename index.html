<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HUB Contador 4.0 - Biblioteca y Asistente</title>

  <link rel="icon" href="Favicon-app.png" sizes="32x32" type="image/png" />
  <link rel="apple-touch-icon" href="Favicon-app.png" />
  <meta name="theme-color" content="#E86C2A">

  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;500;700&family=Poppins:wght@700;900&display=swap" rel="stylesheet">

  <style>
/* =========================================
    S√öPER-APP CONTADOR 4.0 - ESTILOS UNIFICADOS
    ========================================= */

:root {
  --primary: #E86C2A;
  --primary-dark: #cf5d22;
  --secondary: #0A2342;
  --secondary-light: #1e3a5f;
  --bg-light: #F8F9FA;
  --bg-white: #ffffff;
  --bg-code: #f9fafb;
  --border-light: #E0E0E0;
  --border-medium: #d1d5db;
  --text-dark: #111827;
  --text-medium: #374151;
  --text-light: #6b7280;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #dc2626;
  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.04);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
  --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
}

* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }
body {
  font-family: "Lato", sans-serif;
  background: var(--bg-light);
  color: var(--text-dark);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.site-header {
  background: var(--bg-white);
  border-bottom: 1px solid var(--border-light);
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: var(--shadow-sm);
}

.header-inner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  max-width: 1200px;
  margin: 0 auto;
}

.header-left { display: flex; align-items: center; gap: 10px; }
.site-title {
  font-family: 'Poppins', sans-serif;
  font-weight: 700;
  color: var(--secondary);
  font-size: 1.4rem;
  margin: 0;
}
.site-title span { color: var(--primary); }
.header-buttons { display: flex; align-items: center; gap: 10px; }

.btn, .btn-add, .btn-secondary, .btn-primary, .btn-danger, .btn-export, button[type="submit"] {
  font-family: 'Poppins', sans-serif;
  font-weight: 600;
  font-size: 0.9rem;
  border-radius: 8px;
  padding: 10px 18px;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  text-decoration: none;
  display: inline-block;
}

.btn-add, .btn-primary {
  background: var(--primary);
  color: white;
  border: none;
}

.btn-add:hover, .btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.btn-secondary {
  background: transparent;
  border: 2px solid var(--primary);
  color: var(--primary);
}

.btn-secondary:hover {
  background: var(--primary);
  color: white;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-danger:hover {
  background: #b91c1c;
  transform: translateY(-1px);
}

.btn-export {
  background: var(--bg-white);
  border: 2px solid var(--border-medium);
  color: var(--text-medium);
}

.btn-export:hover {
  background: var(--bg-light);
  border-color: var(--text-light);
}

.btn:disabled, .btn-primary:disabled, button:disabled {
  background: var(--text-light);
  cursor: not-allowed;
  transform: none;
  opacity: 0.6;
}

.tab-navigation {
  display: flex;
  gap: 8px;
  border-bottom: 2px solid var(--border-light);
  margin-bottom: 24px;
  background: var(--bg-white);
  padding: 0 20px;
  border-radius: 12px 12px 0 0;
  box-shadow: var(--shadow-sm);
}

.tab-btn {
  font-family: 'Poppins', sans-serif;
  font-weight: 700;
  font-size: 1rem;
  padding: 16px 24px;
  border: none;
  background: transparent;
  cursor: pointer;
  color: var(--text-light);
  border-bottom: 3px solid transparent;
  transition: all 0.3s ease;
  margin-bottom: -2px;
}

.tab-btn:hover {
  color: var(--secondary);
  background: var(--bg-light);
}

.tab-btn.active {
  color: var(--primary);
  border-bottom-color: var(--primary);
  background: transparent;
}

.tab-content { display: none; }
.tab-content.active { display: block; }

.app-container {
  max-width: 1100px;
  margin: 24px auto 40px;
  padding: 0 18px 36px;
}

#contador4-pro-console {
  max-width: 800px;
  margin: 0 auto;
  padding: 32px;
  border: 2px solid var(--border-light);
  border-radius: 16px;
  background: var(--bg-white);
  box-shadow: var(--shadow-md);
}

#contador4-pro-console .console-header {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 2px solid var(--border-light);
}

#contador4-pro-console h3 {
  text-align: center;
  margin: 0;
  font-family: 'Poppins', sans-serif;
  font-weight: 700;
  font-size: 1.6rem;
  color: var(--secondary);
}

#contador4-pro-console label {
  display: block;
  font-weight: 700;
  margin-bottom: 8px;
  margin-top: 16px;
  color: var(--secondary);
  font-size: 0.95rem;
}

#contador4-pro-console input[type='text'], #contador4-pro-console select {
  width: 100%;
  padding: 12px 14px;
  border-radius: 8px;
  border: 2px solid var(--border-medium);
  margin-bottom: 12px;
  background: var(--bg-white);
  font-family: 'Lato', sans-serif;
  font-size: 1rem;
  color: var(--text-dark);
  transition: border-color 0.3s ease;
}

#contador4-pro-console input[type='text']:focus, #contador4-pro-console select:focus {
  outline: none;
  border-color: var(--primary);
}

#prompt-template-preview {
  width: 100%;
  min-height: 120px;
  max-height: 280px;
  padding: 16px;
  border-radius: 10px;
  border: 2px solid var(--border-light);
  margin-bottom: 16px;
  background: var(--bg-code);
  font-family: 'Courier New', Courier, monospace;
  font-size: 0.9rem;
  color: var(--text-medium);
  overflow-y: auto;
  white-space: pre-wrap;
  line-height: 1.6;
}

#prompt-template-preview .bracket-content {
  font-weight: 700;
  color: var(--primary);
  background-color: #fff5f0;
  padding: 3px 6px;
  border-radius: 4px;
  border: 1px solid var(--primary);
}

.tip-box {
  background: #fef3c7;
  border-left: 4px solid var(--warning);
  padding: 14px 18px;
  margin: 16px 0;
  border-radius: 8px;
  font-size: 0.9rem;
  color: #92400e;
}

.tip-box strong { color: #78350f; }

#dynamic-inputs-container {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin: 20px 0;
  padding-top: 20px;
  border-top: 2px dashed var(--border-medium);
}

.dynamic-input-group { display: flex; flex-direction: column; }
.dynamic-input-group label {
  font-weight: 700;
  font-size: 0.9rem;
  color: var(--secondary);
  margin-bottom: 6px;
}
.dynamic-input-group input { margin-bottom: 0; }

#contador4-pro-console button#generate-pro {
  width: 100%;
  padding: 14px;
  background: var(--secondary);
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1.05rem;
  font-weight: 700;
  margin: 20px 0 16px;
  transition: all 0.3s ease;
}

#contador4-pro-console button#generate-pro:hover {
  background: var(--secondary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

#contador4-pro-console button#copy-pro {
  width: 100%;
  padding: 12px;
  background: #eff6ff;
  color: #1e40af;
  border: 2px solid #bfdbfe;
  border-radius: 10px;
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 700;
  margin-bottom: 12px;
  transition: all 0.3s ease;
}

#contador4-pro-console button#copy-pro:hover {
  background: #dbeafe;
  border-color: #93c5fd;
  transform: translateY(-1px);
}

#execution-btn-container {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 16px;
}

.exec-btn {
  padding: 12px 14px;
  background: var(--secondary);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 700;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.exec-btn:hover {
  background: var(--secondary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

#output-console {
  min-height: 120px;
  border-radius: 12px;
  background: var(--bg-code);
  border: 2px solid var(--border-light);
  overflow: hidden;
  margin-bottom: 16px;
}

#output-console .output-loading { padding: 16px; color: var(--text-light); }
#output-console .output-error { 
  padding: 16px; 
  color: var(--danger); 
  font-weight: 700;
  background: #fee2e2;
  border-left: 4px solid var(--danger);
}
#output-console .output-section { padding: 20px; white-space: pre-wrap; }
#output-console .output-title {
  display: block;
  font-weight: 700;
  margin-bottom: 12px;
  color: var(--secondary);
  font-size: 1.05rem;
}
#output-console .output-content {
  font-family: 'Courier New', Courier, monospace;
  font-size: 0.9rem;
  color: var(--text-medium);
  line-height: 1.7;
  -webkit-user-select: text;
  user-select: text;
  background: white;
  padding: 16px;
  border-radius: 8px;
  border: 1px solid var(--border-light);
}

.controls {
  display: flex;
  gap: 16px;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.search-wrap { flex: 1 1 420px; }
#searchInput {
  width: 100%;
  padding: 12px 16px;
  border-radius: 10px;
  border: 2px solid var(--border-medium);
  background: var(--bg-white);
  font-size: 1rem;
  transition: border-color 0.3s ease;
}

#searchInput:focus {
  outline: none;
  border-color: var(--primary);
}

.actions-wrap { display: flex; gap: 10px; align-items: center; }

.filter-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 2px solid var(--border-light);
}

.filter-btn {
  font-family: "Poppins", sans-serif;
  font-weight: 600;
  font-size: 0.9rem;
  padding: 10px 20px;
  border-radius: 20px;
  border: 2px solid var(--border-medium);
  background: var(--bg-white);
  color: var(--text-medium);
  cursor: pointer;
  transition: all 0.3s ease;
}

.filter-btn:hover {
  background: var(--bg-light);
  border-color: var(--text-light);
  transform: translateY(-1px);
}

.filter-btn.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
  box-shadow: 0 4px 8px rgba(232, 108, 42, 0.3);
}

.prompt-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.prompt-empty-message {
  grid-column: 1 / -1;
  text-align: center;
  padding: 48px;
  color: var(--text-light);
  font-size: 1.1rem;
  background: var(--bg-white);
  border-radius: 12px;
  border: 2px dashed var(--border-medium);
}

.prompt-card {
  background: var(--bg-white);
  border: 2px solid var(--border-light);
  border-radius: 12px;
  padding: 20px;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.prompt-card:hover {
  box-shadow: var(--shadow-lg);
  transform: translateY(-4px);
  border-color: var(--primary);
}

.prompt-card.fixed-prompt { border-left: 5px solid var(--primary); }
.prompt-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.prompt-categoria {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.prompt-titulo {
  font-family: 'Poppins', sans-serif;
  font-size: 1.2rem;
  font-weight: 700;
  margin: 0 0 8px 0;
  color: var(--secondary);
  line-height: 1.3;
}

.prompt-subcategoria {
  color: var(--text-light);
  font-size: 0.9rem;
  margin-bottom: 12px;
  line-height: 1.5;
}

.prompt-contenido {
  background: var(--bg-code);
  padding: 14px;
  border-radius: 8px;
  font-family: 'Courier New', monospace;
  font-size: 0.85rem;
  color: var(--text-medium);
  line-height: 1.6;
  margin-bottom: 16px;
  flex-grow: 1;
  border: 1px solid var(--border-light);
}

.prompt-actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: auto;
}

.btn-action {
  padding: 10px 16px;
  border: 2px solid var(--border-medium);
  border-radius: 8px;
  background: var(--bg-white);
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 700;
  transition: all 0.3s ease;
  font-family: 'Lato', sans-serif;
}

.btn-action:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.btn-action.primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
}

.btn-action.primary:hover { opacity: 0.9; }
.btn-action.danger {
  color: var(--danger);
  border-color: #fecaca;
  background: #fef2f2;
}

.btn-action.danger:hover {
  background: #fee2e2;
  border-color: var(--danger);
}

.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(10, 35, 66, 0.6);
  backdrop-filter: blur(4px);
  display: none;
  z-index: 1190;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  width: 92%;
  max-width: 760px;
  max-height: 90vh;
  background: var(--bg-white);
  border-radius: 16px;
  box-shadow: 0 24px 48px rgba(10, 35, 66, 0.3);
  overflow: hidden;
  display: none;
  z-index: 1200;
  transition: all 0.3s ease;
  opacity: 0;
}

.modal.active {
  display: block;
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
}

.modal-overlay.active { display: block; opacity: 1; }
.modal-content {
  padding: 32px;
  max-height: 90vh;
  overflow: auto;
  position: relative;
}

.close-btn {
  position: absolute;
  right: 16px;
  top: 16px;
  border: none;
  background: var(--bg-light);
  font-size: 28px;
  cursor: pointer;
  color: var(--text-medium);
  padding: 8px 12px;
  line-height: 1;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.close-btn:hover {
  background: var(--danger);
  color: white;
  transform: rotate(90deg);
}

.modal-content h2 {
  margin: 0 0 24px 0;
  font-family: "Poppins", sans-serif;
  font-weight: 900;
  color: var(--secondary);
  font-size: 1.8rem;
}

.modal-content label {
  display: block;
  margin-top: 20px;
  color: var(--secondary);
  font-weight: 700;
  font-size: 0.95rem;
  margin-bottom: 8px;
}

.modal-content input[type="text"], .modal-content textarea, .modal-content select {
  width: 100%;
  margin-top: 0;
  padding: 12px 14px;
  border-radius: 8px;
  border: 2px solid var(--border-medium);
  font-size: 1rem;
  font-family: inherit;
  background: var(--bg-white);
  transition: border-color 0.3s ease;
}

.modal-content input[type="text"]:focus, .modal-content textarea:focus, .modal-content select:focus {
  outline: none;
  border-color: var(--primary);
}

.modal-content textarea {
  min-height: 120px;
  resize: vertical;
  line-height: 1.6;
}

.modal-content input:disabled, .modal-content textarea:disabled, .modal-content select:disabled {
  background: var(--bg-light);
  color: var(--text-light);
  cursor: not-allowed;
  opacity: 0.7;
}

.modal-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  margin-top: 32px;
  flex-wrap: wrap;
  border-top: 2px solid var(--border-light);
  padding-top: 24px;
}

.btn-secondary#cancelBtn {
  background: var(--bg-light);
  border: 2px solid var(--border-medium);
  color: var(--text-medium);
}

.btn-secondary#cancelBtn:hover {
  background: var(--border-light);
  border-color: var(--text-light);
}

.tips-section {
  margin-top: 56px;
  padding-top: 40px;
  border-top: 2px solid var(--border-light);
}

.tips-section h2 {
  font-family: "Poppins", sans-serif;
  font-size: 1.8rem;
  font-weight: 900;
  color: var(--secondary);
  text-align: center;
  margin-bottom: 32px;
}

.tips-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 24px;
}

.tip-card {
  background: var(--bg-white);
  border-radius: 12px;
  padding: 24px;
  border: 2px solid var(--border-light);
  box-shadow: var(--shadow-sm);
  border-left: 5px solid var(--primary);
  transition: all 0.3s ease;
}

.tip-card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-4px);
}

.tip-card h3 {
  font-family: "Poppins", sans-serif;
  font-weight: 700;
  color: var(--primary);
  margin: 0 0 12px 0;
  font-size: 1.15rem;
}

.tip-card p {
  font-size: 0.95rem;
  line-height: 1.7;
  color: var(--text-medium);
  margin: 0;
}

.app-footer {
  margin: 56px auto 24px;
  padding: 32px 16px;
  background: var(--bg-white);
  border-top: 2px solid var(--border-light);
  text-align: center;
  color: var(--text-light);
  font-size: 0.95rem;
  line-height: 1.7;
}

.app-footer p { margin: 0; }
.app-footer a {
  color: var(--primary);
  font-weight: 700;
  text-decoration: none;
  transition: color 0.3s ease;
}

.app-footer a:hover {
  color: var(--primary-dark);
  text-decoration: underline;
}

@media (max-width: 768px) {
  .header-inner { flex-direction: column; gap: 12px; }
  .site-title { font-size: 1.15rem; text-align: center; }
  .header-buttons { flex-direction: column; width: 100%; }
  .btn-add, .btn-secondary { width: 100%; text-align: center; }
  .tab-navigation { padding: 0 12px; gap: 4px; }
  .tab-btn { font-size: 0.85rem; padding: 12px 16px; }
  #contador4-pro-console { padding: 20px; }
  #execution-btn-container { grid-template-columns: 1fr; }
  .prompt-list { grid-template-columns: 1fr; }
  .modal-content { padding: 24px; }
  .modal-actions { flex-direction: column; }
  .modal-actions button { width: 100%; }
}

@media (max-width: 600px) {
  .app-container { margin: 16px 12px 32px; padding: 0 12px 24px; }
  .controls { flex-direction: column; align-items: stretch; }
  .search-wrap, .actions-wrap { width: 100%; }
  .actions-wrap { flex-direction: column; }
  .filter-controls { gap: 8px; }
  .filter-btn { font-size: 0.85rem; padding: 8px 14px; }
}
  </style>
</head>
<body>

  <header class="site-header">
    <div class="header-inner">
      <div class="header-left">
        <h1 class="site-title">Ecosistema IA ‚Äì <span>Contador 4.0</span></h1>
      </div>
      <div class="header-buttons">
        <button id="viewSheetBtn" class="btn-secondary">Ver o editar en Google Sheets</button>
      </div>
    </div>
  </header>

  <main class="app-container">
    <nav class="tab-navigation">
      <button id="tab-generator" class="tab-btn active">üöÄ Generador Express (115+ Prompts)</button>
      <button id="tab-library" class="tab-btn">üìö Mi Biblioteca Personal</button>
    </nav>

    <section id="assistant-view" class="tab-content active">
      <div id="contador4-pro-console">
        <div class="console-header">
          <h3>üöÄ Asistente Contador 4.0</h3>
        </div>
        <label for="cat-pro">Categor√≠a</label>
        <select id="cat-pro"></select>
        <label for="subcat-pro">Subcategor√≠a</label>
        <select id="subcat-pro"></select>
        <label for="task-pro">Prompt</label>
        <select id="task-pro"></select>
        <label for="prompt-template-preview">Plantilla del Prompt</label>
        <div id="prompt-template-preview">Selecciona una tarea para ver la plantilla...</div>
        <div class="tip-box">üí° <strong>Tip:</strong> Rellena los campos que aparecen abajo para personalizar tu prompt.</div>
        <div id="dynamic-inputs-container"></div>
        <button id="generate-pro">Generar Prompt</button>
        <div id="output-console"></div>
        <button id="copy-pro" style="display: none;">Copiar Prompt</button>
        <div id="execution-btn-container" style="display: none;">
          <button id="exec-claude" class="exec-btn">ü§ì Ejecutar en Claude</button>
          <button id="exec-chatgpt" class="exec-btn">üí¨ Ejecutar en ChatGPT</button>
          <button id="exec-gemini" class="exec-btn">‚ú® Ejecutar en Gemini</button>
        </div>
      </div>
    </section>

    <section id="library-view" class="tab-content">
      <section class="controls">
        <div class="search-wrap">
          <input id="searchInput" type="search" placeholder="Buscar en Mi Biblioteca..." />
        </div>
        <div class="actions-wrap">
          <button id="addPromptBtn" class="btn-add">+ Nuevo Prompt</button>
          <button id="exportBtn" class="btn btn-export">üì§ Exportar Excel</button>
        </div>
      </section>

      <nav id="filterControls" class="filter-controls">
        <button class="filter-btn active" data-filter="todos">Todos</button>
        <button class="filter-btn" data-filter="diario">Diario</button>
        <button class="filter-btn" data-filter="semanal">Semanal</button>
        <button class="filter-btn" data-filter="mensual">Mensual</button>
        <button class="filter-btn" data-filter="ocasional">Ocasional</button>
      </nav>

      <section id="promptList" class="prompt-list" aria-live="polite"></section>

      <section class="tips-section">
        <h2>Consejos para tu Biblioteca</h2>
        <div class="tips-grid">
          <div class="tip-card">
            <h3>Personaliza Siempre</h3>
            <p>Usa los prompts base como una plantilla. El verdadero poder est√° en ajustarlos a tu cliente, tu voz y la situaci√≥n espec√≠fica.</p>
          </div>
          <div class="tip-card">
            <h3>El Contexto es Clave</h3>
            <p>El campo "Contexto / Cu√°ndo usarlo" es tu mejor aliado. Describe la situaci√≥n (ej: "Email para cliente moroso") para encontrarlo r√°pido.</p>
          </div>
          <div class="tip-card">
            <h3>Crea tus Joyas</h3>
            <p>¬øDescubriste un prompt genial? ¬°No lo dejes en un bloc de notas! Gu√°rdalo aqu√≠. Esta biblioteca crece contigo.</p>
          </div>
        </div>
      </section>
    </section>
  </main>

  <div id="modalOverlay" class="modal-overlay" aria-hidden="true"></div>
  <div id="promptModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content">
      <button class="close-btn close-modal" aria-label="Cerrar">&times;</button>
      <h2 id="modalTitle">Nuevo Prompt</h2>
      <form id="promptForm" autocomplete="off">
        <label for="promptName">Nombre del Prompt</label>
        <input id="promptName" type="text" required />
        <label for="promptText">Contenido del Prompt</label>
        <textarea id="promptText" required placeholder="Escribe el prompt completo aqu√≠..."></textarea>
        <label for="promptContext">Contexto / Cu√°ndo usarlo</label>
        <textarea id="promptContext"></textarea>
        <label for="promptPersonalization">Personalizaci√≥n</label>
        <textarea id="promptPersonalization" placeholder="Ajustes o adaptaciones espec√≠ficas..."></textarea>
        <label for="promptFrequency">Frecuencia</label>
        <select id="promptFrequency">
          <option value="diario">Diario</option>
          <option value="semanal" selected>Semanal</option>
          <option value="mensual">Mensual</option>
          <option value="ocasional">Ocasional</option>
        </select>
        <div class="modal-actions">
          <button id="savePrompt" type="submit" class="btn btn-primary">Guardar</button>
          <button id="deletePrompt" type="button" class="btn btn-danger">üóëÔ∏è Eliminar</button>
          <button id="cancelBtn" type="button" class="btn btn-secondary">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <footer class="app-footer">
    <p>
      Ecosistema Contador 4.0 es un desarrollo de
      <a href="https://jairoamaya.co" target="_blank" rel="noopener">Jairo Amaya ‚Äì Full Stack Marketer</a>.
      <br>Todos los derechos reservados ¬© 2025.
    </p>
  </footer>
<script>
document.addEventListener("DOMContentLoaded", () => {

  // ========================================================
  // === 1. L√ìGICA DE LA BIBLIOTECA PERSONAL (v2.5) =========
  // ========================================================

  const addPromptBtn = document.getElementById("addPromptBtn");
  const viewSheetBtn = document.getElementById("viewSheetBtn");
  const promptModal = document.getElementById("promptModal");
  const modalOverlay = document.getElementById("modalOverlay");
  const closeBtns = document.querySelectorAll(".close-modal, .close-btn");
  const cancelBtn = document.getElementById("cancelBtn");
  const promptForm = document.getElementById("promptForm");
  const promptList = document.getElementById("promptList");
  const modalTitle = document.getElementById("modalTitle");
  const exportBtn = document.getElementById("exportBtn");
  const searchInput = document.getElementById("searchInput");
  const deleteBtn = document.getElementById("deletePrompt");
  const saveBtn = document.getElementById("savePrompt");
  const filterBtns = document.querySelectorAll(".filter-btn");

  const nameInput = document.getElementById("promptName");
  const textInput = document.getElementById("promptText");
  const contextInput = document.getElementById("promptContext");
  const personalizationInput = document.getElementById("promptPersonalization");
  const freqSelect = document.getElementById("promptFrequency");

  let userPrompts = [];
  let currentFilter = 'todos';

  const defaultPrompts = [
    { id: "base-1", name: "An√°lisis Express Rentabilidad PYME", context: "Cliente pregunta por qu√© baj√≥ la utilidad neta.", personalization: "Incluye 'sector retail Colombia' y lenguaje simple.", text: "Act√∫a como analista financiero experto. Eval√∫a los m√°rgenes de utilidad neta de una PYME del sector retail colombiano.", frequency: "semanal", fixed: true, createdAt: Date.now() },
    { id: "base-2", name: "Propuesta Premium de Servicios", context: "Prospecto solicita cotizaci√≥n o upgrade de cliente actual.", personalization: "Cambio 'CEO' por 'Gerente', √©nfasis en ROI cuantificado.", text: "Redacta una propuesta contable con enfoque premium para retener clientes y destacar ROI con claridad.", frequency: "mensual", fixed: true, createdAt: Date.now() },
    { id: "base-3", name: "Calendario Fiscal Automatizado", context: "Inicio de mes para planificar obligaciones.", personalization: "Solo clientes r√©gimen com√∫n, formato tabla con alertas.", text: "Genera un calendario fiscal automatizado para empresas en r√©gimen com√∫n con fechas y alertas cr√≠ticas.", frequency: "mensual", fixed: true, createdAt: Date.now() },
    { id: "base-4", name: "Reporte Ejecutivo Semanal", context: "Todos los lunes para clientes premium.", personalization: "Dashboard visual, m√°ximo 1 p√°gina, 3 m√©tricas clave.", text: "Elabora un reporte ejecutivo semanal con resumen financiero, proyecci√≥n y 3 m√©tricas clave.", frequency: "semanal", fixed: true, createdAt: Date.now() },
    { id: "base-5", name: "Detecci√≥n de Irregularidades en N√≥mina", context: "Antes de procesar n√≥mina mensual.", personalization: "Detectar duplicados, horas extras inusuales y empleados inactivos.", text: "Analiza n√≥mina y devuelve hallazgos: duplicados, horas extras an√≥malas, posibles empleados fantasma.", frequency: "mensual", fixed: true, createdAt: Date.now() }
  ];

  try {
    userPrompts = JSON.parse(localStorage.getItem("userPrompts")) || [];
  } catch (e) {
    console.warn("Error al cargar userPrompts de localStorage:", e);
    userPrompts = [];
  }

  function getAllPrompts() {
    const sortedUserPrompts = userPrompts.sort((a, b) => b.createdAt - a.createdAt);
    return [...sortedUserPrompts, ...defaultPrompts];
  }
  
  const truncate = (str, len) => {
    if (!str) return "";
    return str.length > len ? str.substring(0, len) + '...' : str;
  };
  
  const capitalize = (str) => {
    if (!str) return "";
    return str.charAt(0).toUpperCase() + str.slice(1);
  };

  function applyFiltersAndSearch() {
    const allPrompts = getAllPrompts();
    const searchTerm = searchInput.value.toLowerCase();

    const filteredByCategory = allPrompts.filter(p => {
      if (currentFilter === 'todos') return true;
      return p.frequency === currentFilter;
    });

    const filteredBySearch = filteredByCategory.filter(p => {
      if (searchTerm === '') return true;
      return p.name.toLowerCase().includes(searchTerm) ||
             (p.context && p.context.toLowerCase().includes(searchTerm)) ||
             (p.text && p.text.toLowerCase().includes(searchTerm));
    });
    
    renderPromptsUI(filteredBySearch);
  }

  function renderPromptsUI(listToRender) {
    promptList.innerHTML = "";
    
    if (!Array.isArray(listToRender) || listToRender.length === 0) {
      const emptyMsg = (searchInput.value || currentFilter !== 'todos')
        ? "No se encontraron prompts que coincidan con tu filtro o b√∫squeda."
        : "No hay prompts a√∫n. Presiona '+ Nuevo Prompt' para crear uno.";
      
      const empty = document.createElement("div");
      empty.className = "prompt-empty-message";
      empty.textContent = emptyMsg;
      promptList.appendChild(empty);
      return;
    }

    listToRender.forEach(p => {
      const card = document.createElement("div");
      card.className = "prompt-card";
      if (p.fixed) card.classList.add("fixed-prompt");
      
      const categoria = capitalize(p.frequency) || 'General';
      const contexto = truncate(p.context || 'Sin contexto', 100);
      const contenido = truncate(p.text || 'Prompt vac√≠o', 150);

      let actionsHTML = '';
      if (p.fixed) {
        actionsHTML = `<button class="btn-action primary btn-copy" data-id="${p.id}">üìã Copiar</button>`;
      } else {
        actionsHTML = `
          <button class="btn-action primary btn-copy" data-id="${p.id}">üìã Copiar</button>
          <button class="btn-action btn-view" data-id="${p.id}">üëÅÔ∏è Ver / Editar</button>
          <button class="btn-action danger btn-delete" data-id="${p.id}">üóëÔ∏è Eliminar</button>
        `;
      }

      card.innerHTML = `
        <div class="prompt-header">
          <span class="prompt-categoria">${categoria}</span>
        </div>
        <h3 class="prompt-titulo">${p.name}</h3>
        <p class="prompt-subcategoria">${contexto}</p>
        <div class="prompt-contenido">
          ${contenido}
        </div>
        <div class="prompt-actions">
          ${actionsHTML}
        </div>
      `;

      card.querySelector('.btn-copy').addEventListener('click', (e) => {
        e.stopPropagation();
        copiarPrompt(p.id);
      });

      if (!p.fixed) {
        card.querySelector('.btn-view').addEventListener('click', (e) => {
          e.stopPropagation();
          openModal(p);
        });
        card.querySelector('.btn-delete').addEventListener('click', (e) => {
          e.stopPropagation();
          eliminarPrompt(p.id);
        });
      }

      promptList.appendChild(card);
    });
  }

  function copiarPrompt(id) {
    const prompt = getAllPrompts().find(p => p.id === id);
    if (!prompt) return;
    navigator.clipboard.writeText(prompt.text).then(() => {
      alert("‚úÖ Prompt copiado al portapapeles");
    }).catch(err => console.error('Error al copiar:', err));
  }

  function eliminarPrompt(id) {
    if (!id || !confirm("¬øSeguro que deseas eliminar este prompt? Esta acci√≥n no se puede deshacer.")) return;
    userPrompts = userPrompts.filter(p => p.id !== id);
    localStorage.setItem("userPrompts", JSON.stringify(userPrompts));
    applyFiltersAndSearch();
    closeModal();
  }

  function openModal(prompt = null) {
    promptForm.reset();
    delete promptForm.dataset.editId;
    delete promptForm.dataset.isFixed;
    deleteBtn.style.display = "none";
    saveBtn.style.display = "inline-block";

    if (prompt) {
      modalTitle.textContent = prompt.fixed ? "Vista de Prompt Base" : "Editar Prompt";
      nameInput.value = prompt.name || "";
      textInput.value = prompt.text || "";
      contextInput.value = prompt.context || "";
      personalizationInput.value = prompt.personalization || "";
      freqSelect.value = prompt.frequency || "semanal";
      promptForm.dataset.editId = prompt.id;
      promptForm.dataset.isFixed = prompt.fixed ? "true" : "false";
      const readonly = !!prompt.fixed;
      [nameInput, textInput, contextInput, personalizationInput, freqSelect].forEach(el => { el.disabled = readonly; });
      if (prompt.fixed) saveBtn.style.display = "none";
      else deleteBtn.style.display = "inline-block";
    } else {
      modalTitle.textContent = "Nuevo Prompt";
      [nameInput, textInput, contextInput, personalizationInput, freqSelect].forEach(el => { el.disabled = false; });
    }
    showOverlay();
    promptModal.classList.add("active");
  }

  function closeModal() {
    promptModal.classList.remove("active");
    hideOverlay();
  }

  function showOverlay() {
    modalOverlay.classList.add("active");
  }
  
  function hideOverlay() {
    modalOverlay.classList.remove("active");
  }

  modalOverlay.addEventListener("click", closeModal);
  closeBtns.forEach(b => b.addEventListener("click", closeModal));
  cancelBtn.addEventListener("click", closeModal);
  addPromptBtn.addEventListener("click", () => openModal(null));

  promptForm.addEventListener("submit", (e) => {
    e.preventDefault();
    if (promptForm.dataset.isFixed === "true") return;

    const id = promptForm.dataset.editId || String(Date.now());
    let createdAt = Date.now();
    const existingIndex = userPrompts.findIndex(p => p.id === id);
    if (existingIndex > -1) createdAt = userPrompts[existingIndex].createdAt;

    const newPrompt = {
      id,
      name: nameInput.value.trim() || "Sin t√≠tulo",
      text: textInput.value.trim(),
      context: contextInput.value.trim(),
      personalization: personalizationInput.value.trim(),
      frequency: freqSelect.value,
      fixed: false,
      createdAt: createdAt
    };

    if (existingIndex > -1) userPrompts[existingIndex] = newPrompt;
    else userPrompts.push(newPrompt);

    localStorage.setItem("userPrompts", JSON.stringify(userPrompts));
    applyFiltersAndSearch();
    closeModal();
  });

  deleteBtn.addEventListener("click", () => {
    const id = promptForm.dataset.editId;
    eliminarPrompt(id);
  });

  searchInput.addEventListener("input", () => {
    applyFiltersAndSearch();
  });

  filterBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      currentFilter = btn.dataset.filter;
      filterBtns.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      applyFiltersAndSearch();
    });
  });

  viewSheetBtn.addEventListener("click", () => {
    const sheetUrl = "https://docs.google.com/spreadsheets/d/1LdUoniteMSwjeLTm0RfCtk5rPMVBY4jQte3Sh0SKKNc/edit?usp=sharing";
    window.open(sheetUrl, "_blank");
  });

  exportBtn.addEventListener("click", () => {
    const url = "https://github.com/jairoamayalaverde/contador4-biblioteca/raw/main/Biblioteca%20de%20Prompts%20Contador%204.0.xlsx";
    window.open(url, "_blank");
  });

  // ========================================================
  // === 2. L√ìGICA DEL GENERADOR EXPRESS (CON TODAS LAS 6 CATEGOR√çAS) ===
  // ========================================================

  const promptsData = [
    {
      "title": "üìä An√°lisis Financiero Estrat√©gico",
      "icon": "üìà",
      "subcategories": [
        {
          "title": "Evaluaci√≥n Financiera",
          "prompts": [
            {
              "title": "An√°lisis Integral de Estados Financieros",
              "prompt": "Act√∫a como un analista financiero senior. Analiza los estados financieros adjuntos (balance general, estado de resultados y estado de cambios en el patrimonio) de [nombre de la empresa/cliente] de los √∫ltimos [n√∫mero de a√±os] a√±os. Identifica las [n√∫mero] tendencias m√°s significativas, eval√∫a la salud financiera general de la empresa, y proporciona [n√∫mero] recomendaciones estrat√©gicas basadas en tu an√°lisis. Incluye comparaciones a√±o a a√±o y explica el impacto de cada hallazgo en la posici√≥n competitiva de la empresa."
            },
            {
              "title": "An√°lisis Comparativo",
              "prompt": "Compara los estados financieros de esta empresa con los de sus [n√∫mero] principales competidores en el sector [tipo de industria/sector]. Identifica fortalezas y debilidades relativas en t√©rminos de estructura de capital, eficiencia operativa y posici√≥n de liquidez. Proporciona un ranking de desempe√±o financiero y explica qu√© m√©tricas clave determinan la posici√≥n de cada empresa en el mercado."
            },
            {
              "title": "Detecci√≥n de Anomal√≠as",
              "prompt": "Examina estos estados financieros buscando inconsistencias, irregularidades o se√±ales de alerta relacionadas con [tipo espec√≠fico de an√°lisis: reconocimiento de ingresos/valuaci√≥n de inventario/uso de reservas]. Analiza la coherencia entre las diferentes partidas, identifica variaciones inusuais period-over-period, y eval√∫a la calidad de los earnings. Proporciona un informe de due diligence destacando cualquier √°rea que requiera investigaci√≥n adicional o aclaraci√≥n por parte de la gerencia."
            }
          ]
        },
        {
          "title": "An√°lisis de Flujo de Efectivo",
          "prompts": [
            {
              "title": "An√°lisis de Sostenibilidad",
              "prompt": "Analiza el estado de flujo de efectivo de los √∫ltimos [n√∫mero de a√±os] a√±os, enfoc√°ndote en la sostenibilidad de la generaci√≥n de efectivo. Eval√∫a la calidad del flujo operativo, identifica patrones estacionales, y determina si la empresa puede mantener sus operaciones, inversiones y pagos de dividendos sin financiamiento externo. Incluye proyecciones de flujo libre de efectivo para los pr√≥ximos [n√∫mero] a√±os."
            },
            {
              "title": "Optimizaci√≥n de Capital de Trabajo",
              "prompt": "Examina los componentes del flujo de efectivo operativo, particularmente los cambios en capital de trabajo. Identifica oportunidades de optimizaci√≥n en [√°rea: cuentas por cobrar/inventarios/cuentas por pagar]. Calcula el ciclo de conversi√≥n de efectivo y proporciona [n√∫mero] estrategias espec√≠ficas para mejorar la generaci√≥n de efectivo operativo sin comprometer las operaciones."
            },
            {
              "title": "Evaluaci√≥n de Capacidad de Inversi√≥n",
              "prompt": "Analiza la capacidad de la empresa para financiar proyectos de crecimiento bas√°ndote en su flujo de efectivo hist√≥rico y proyectado. Eval√∫a el equilibrio entre flujo operativo, necesidades de capex, servicio de deuda y distribuciones a accionistas. Determina el monto √≥ptimo disponible para nuevas inversiones y recomienda una estructura de financiamiento para proyectos estrat√©gicos de [monto/cantidad]."
            }
          ]
        },
        {
          "title": "Rentabilidad por L√≠nea de Negocio",
          "prompts": [
            {
              "title": "An√°lisis de Contribuci√≥n Marginal",
              "prompt": "Analiza la rentabilidad de cada l√≠nea de negocio calculando m√°rgenes brutos, contribuci√≥n marginal y EBITDA por segmento [nombre de la l√≠nea de negocio]. Identifica qu√© l√≠neas est√°n subsidiando a otras, eval√∫a la asignaci√≥n de costos fijos, y determina el punto de equilibrio para cada unidad de negocio. Proporciona recomendaciones sobre qu√© l√≠neas expandir, mantener o descontinuar."
            },
            {
              "title": "An√°lisis de Valor Econ√≥mico Agregado (EVA)",
              "prompt": "Calcula el EVA para cada l√≠nea de negocio [nombre de la l√≠nea de negocio], considerando el costo de capital espec√≠fico y los activos empleados. Identifica qu√© segmentos est√°n creando o destruyendo valor, analiza los drivers de rentabilidad √∫nicos de cada l√≠nea, y propone estrategias para maximizar el valor econ√≥mico total de la empresa."
            },
            {
              "title": "Optimizaci√≥n de Portfolio de Negocios",
              "prompt": "Usando la matriz BCG y an√°lisis de rentabilidad, eval√∫a el portfolio de l√≠neas de negocio. Clasifica cada segmento seg√∫n su posici√≥n competitiva y atractivo del mercado, analiza la sinergia entre l√≠neas, y desarrolla una estrategia de asignaci√≥n de recursos que maximice el retorno sobre el capital invertido a nivel corporativo en el sector [tipo de industria/sector]."
            }
          ]
        },
        {
          "title": "Ratios y M√©tricas Financieras",
          "prompts": [
            {
              "title": "Dashboard de Ratios Clave",
              "prompt": "Crea un dashboard ejecutivo con los [n√∫mero] ratios financieros m√°s cr√≠ticos organizados en [n√∫mero] categor√≠as: liquidez, eficiencia, apalancamiento, rentabilidad y mercado. Para cada ratio, proporciona el valor actual, tendencia de [n√∫mero] a√±os, benchmark del sector [tipo de industria/sector], y sem√°foro de alerta (verde/amarillo/rojo). Incluye interpretaci√≥n ejecutiva y acciones recomendadas para ratios en zona de riesgo."
            },
            {
              "title": "An√°lisis Predictivo con Ratios",
              "prompt": "Utiliza los ratios financieros hist√≥ricos para desarrollar un modelo predictivo de la salud financiera futura de [nombre de la empresa]. Identifica los ratios m√°s correlacionados con el desempe√±o operativo, calcula z-scores de Altman y Piotroski F-Score, y proporciona una probabilidad de stress financiero en los pr√≥ximos [per√≠odo de tiempo variable: 12-24 meses]. Incluye escenarios de sensibilidad bajo un evento de [evento espec√≠fico: aumento de tasas/recesi√≥n]."
            },
            {
              "title": "Benchmarking Sectorial de Ratios",
              "prompt": "Compara los ratios financieros de la empresa contra el percentil 25, mediana y percentil 75 de su sector industrial [tipo de industria/sector]. Identifica en qu√© m√©tricas la empresa sobresale o queda rezagada, analiza las causas estructurales de las diferencias, y establece targets realistas de mejora para alcanzar el cuartil superior en [n√∫mero] a√±os."
            }
          ]
        },
        {
          "title": "Gesti√≥n de Riesgos Financieros",
          "prompts": [
            {
              "title": "Mapa de Riesgos Integral",
              "prompt": "Desarrolla un mapa comprensivo de riesgos financieros evaluando: riesgo de liquidez, riesgo crediticio, riesgo de mercado, riesgo operacional y riesgo de concentraci√≥n en [√°rea espec√≠fica]. Para cada categor√≠a, identifica los [n√∫mero] riesgos principales, eval√∫a probabilidad e impacto, y propone controles preventivos y planes de contingencia. Incluye m√©tricas de early warning para cada tipo de riesgo."
            },
            {
              "title": "Stress Testing Financiero",
              "prompt": "Dise√±a y ejecuta stress tests bajo [n√∫mero] escenarios: recesi√≥n moderada, crisis sectorial y shock de tasas de inter√©s de [monto/cantidad] puntos base. Eval√∫a el impacto en liquidez, solvencia y rentabilidad, identifica puntos de quiebre cr√≠ticos, y determina las acciones de contingencia necesarias. Calcula el capital de reserva requerido para mantener operaciones bajo cada escenario adverso."
            },
            {
              "title": "Sistema de Alertas Tempranas",
              "prompt": "Establece un sistema de alertas tempranas basado en indicadores financieros y operativos para [√°rea/departamento]. Define umbrales cr√≠ticos para ratios clave, identifica combinaciones de m√©tricas que hist√≥ricamente preceden problemas financieros, y crea un scoring de riesgo automatizado. Proporciona un protocolo de escalamiento y acciones correctivas para cada nivel de alerta del sistema."
            }
          ]
        }
      ]
    },
    {
      "title": "üíº Comunicaci√≥n Empresarial de Alto Impacto",
      "icon": "‚úâÔ∏è",
      "subcategories": [
        {
          "title": "Comunicaciones a Clientes",
          "prompts": [
            {
              "title": "Comunicaci√≥n de Cambios o Ajustes",
              "prompt": "Redacta una carta profesional dirigida a nuestros clientes corporativos explicando [cambio espec√≠fico: aumento de tarifas/modificaci√≥n de servicios/nueva pol√≠tica]. La carta debe: mantener un tono emp√°tico y transparente, explicar las razones comerciales detr√°s de la decisi√≥n, destacar el valor agregado que continuamos proporcionando, incluir una l√≠nea de tiempo clara de implementaci√≥n, y ofrecer un canal directo para consultas. Aseg√∫rate de que el mensaje refuerce la relaci√≥n a largo plazo y mitigue cualquier preocupaci√≥n potencial."
            },
            {
              "title": "Explicaci√≥n de Resultados o Performance",
              "prompt": "Elabora una comunicaci√≥n personalizada para explicar a nuestro cliente [nombre del cliente] los resultados del proyecto/servicio realizado en el √∫ltimo per√≠odo de [per√≠odo de tiempo variable]. La carta debe incluir: un resumen ejecutivo de los logros clave, m√©tricas de desempe√±o comparadas con objetivos iniciales, explicaci√≥n de cualquier desviaci√≥n o reto enfrentado, impacto tangible en su negocio, pr√≥ximos pasos recomendados, y una invitaci√≥n para una reuni√≥n de seguimiento. El tono debe ser profesional pero cercano, demostrando nuestro compromiso con su √©xito."
            },
            {
              "title": "Comunicaci√≥n de Crisis o Incidentes",
              "prompt": "Desarrolla una carta de comunicaci√≥n de crisis para informar a los clientes afectados sobre [incidente espec√≠fico: brecha de seguridad/interrupci√≥n de servicio/retiro de producto]. La comunicaci√≥n debe seguir el protocolo: reconocimiento inmediato del problema, explicaci√≥n clara de qu√© ocurri√≥ y por qu√©, detalle de las acciones correctivas ya implementadas, medidas preventivas para evitar recurrencia, compensaci√≥n o remediaci√≥n ofrecida, y cronograma de seguimiento. El mensaje debe transmitir responsabilidad, transparencia y confianza en nuestra capacidad de resoluci√≥n."
            }
          ]
        },
        {
          "title": "Reportes Ejecutivos",
          "prompts": [
            {
              "title": "Dashboard Ejecutivo Mensual",
              "prompt": "Crea un reporte ejecutivo mensual personalizado para [nombre del ejecutivo/√°rea] que incluya: resumen de [n√∫mero] puntos clave del mes, dashboard visual con [n√∫mero] KPIs cr√≠ticos para su rol en el departamento de [nombre de √°rea/departamento], an√°lisis de tendencias vs. per√≠odo anterior, identificaci√≥n de [n√∫mero] oportunidades inmediatas, alertas sobre riesgos emergentes, y recomendaciones accionables para los pr√≥ximos [n√∫mero] d√≠as. El formato debe ser conciso (m√°ximo 2 p√°ginas), visualmente atractivo, y enfocado en decisiones estrat√©gicas que el ejecutivo debe tomar."
            },
            {
              "title": "Reporte de Performance por √Årea",
              "prompt": "Dise√±a un reporte ejecutivo trimestral personalizado para el Director de [√°rea espec√≠fica] que analice: performance vs. objetivos establecidos, comparaci√≥n con benchmarks del sector [tipo de industria/sector], an√°lisis de causas ra√≠z de desviaciones, impacto en otros departamentos y la organizaci√≥n general, iniciativas en curso y su progreso, recomendaciones estrat√©gicas para el siguiente trimestre. Incluye gr√°ficos de tendencias, sem√°foros de alerta, y un plan de acci√≥n priorizado."
            },
            {
              "title": "Reporte Estrat√©gico de Junta Directiva",
              "prompt": "Elabora un reporte ejecutivo para la Junta Directiva de [nombre de la empresa] que cubra: estado general del negocio con m√©tricas financieras clave, avance en objetivos estrat√©gicos anuais, an√°lisis de mercado y posici√≥n competitiva en [tipo de industria/sector], principales riesgos y oportunidades identificados, decisiones cr√≠ticas que requieren aprobaci√≥n de la junta, y outlook para los pr√≥ximos [per√≠odo de tiempo variable]. El documento debe ser de nivel estrat√©gico, incluir resumen ejecutivo de una p√°gina, y estar preparado para generar discusi√≥n y toma de decisiones en el board."
            }
          ]
        }
      ]
    },
    {
      "title": "üìã Propuestas y Cotizaciones que Cierran Negocios",
      "icon": "üí∞",
      "subcategories": [
        {
          "title": "Propuestas de Servicios",
          "prompts": [
            {
              "title": "Propuesta Integral de Servicios Contables",
              "prompt": "Desarrolla una propuesta comercial completa para ofrecer servicios contables integrales a [tipo de empresa/sector]. La propuesta debe incluir: an√°lisis de las necesidades contables espec√≠ficas del cliente, descripci√≥n detallada de servicios (contabilidad general, n√≥mina, impuestos, reportes financieros), metodolog√≠a de trabajo y cronograma de entregas, equipo asignado com perfiles profesionales, diferenciadores competitivos y valor agregado √∫nico, estructura de costos transparente com opciones de pago, garant√≠as de calidad y SLAs, casos de √©xito similares, y pr√≥ximos pasos del proceso. El tono debe ser profesional, consultivo y enfocado en generar confianza."
            },
            {
              "title": "Propuesta de Migraci√≥n y Modernizaci√≥n Contable",
              "prompt": "Elabora una propuesta especializada para la modernizaci√≥n del sistema contable de un cliente que actualmente maneja procesos manuales o sistemas obsoletos. Incluye: diagn√≥stico del estado actual y gaps identificados en [√°rea espec√≠fica: cuentas por pagar/activos fijos], propuesta de implementaci√≥n de [software contable/ERP] moderno, plan de migraci√≥n de datos hist√≥ricos, capacitaci√≥n del equipo interno del cliente, procesos optimizados y controles internos mejorados, cronograma de implementaci√≥n por fases, an√°lisis costo-beneficio de la modernizaci√≥n, soporte post-implementaci√≥n, y m√©tricas de √©xito esperadas. Enf√≥cate en el ROI y la eficiencia operativa."
            }
          ]
        },
        {
          "title": "Cotizaciones y Precios",
          "prompts": [
            {
              "title": "Cotizaci√≥n de Paquetes Diferenciados",
              "prompt": "Crea una cotizaci√≥n estructurada en [n√∫mero] paquetes de servicios (B√°sico, Profesional, Premium) para servicios contables, dirigida a [tipo de cliente: PYME/corporativo/startup]. Cada paquete debe incluir: descripci√≥n clara de servicios incluidos, frecuencia de entregas y reportes, nivel de soporte y atenci√≥n, herramientas y tecnolog√≠a incluida, precio [per√≠odo de tiempo variable: mensual/anual] com descuentos por anualidad, tabla comparativa visual de caracter√≠sticas, opciones de add-ons disponibles, t√©rminos de contrato y condiciones de pago. Incluye recomendaci√≥n del paquete m√°s adecuado seg√∫n el perfil del cliente y justificaci√≥n del valor de cada tier."
            }
          ]
        }
      ]
    },
    {
      "title": "üìà Reportes y Dashboards Inteligentes",
      "icon": "üìä",
      "subcategories": [
        {
          "title": "Sistemas de KPIs",
          "prompts": [
            {
              "title": "Framework Integral de KPIs por Nivel Organizacional",
              "prompt": "Dise√±a un sistema completo de KPIs financieros estructurado en [n√∫mero] niveles: estrat√©gico (C-level), t√°ctico (gerencias medias) y operativo (supervisi√≥n). Para cada nivel define: [n√∫mero] KPIs principais com sus f√≥rmulas espec√≠ficas, frecuencia de medici√≥n y reporte, umbrales de alerta (verde/amarillo/rojo), benchmarks del sector [tipo de industria/sector] cuando aplique, interrelaci√≥n entre KPIs de diferentes niveles, dashboard visual correspondiente, y responsable de cada m√©trica en [nombre de √°rea/departamento]. Incluye KPIs de rentabilidad, liquidez, eficiencia, crecimiento y riesgo. El framework debe permitir cascadeo desde objetivos estrat√©gicos hasta m√©tricas operativas diarias."
            }
          ]
        },
        {
          "title": "Reportes Automatizados",
          "prompts": [
            {
              "title": "Sistema de Reportes Autom√°ticos Multi-periodicidad",
              "prompt": "Dise√±a una arquitectura de reportes automatizados que genere: reportes diarios de cash flow y posici√≥n financiera, reportes semanales de performance vs. budget, reportes mensuales de P&L completo y an√°lisis de variaciones, reportes trimestrales de tendencias y an√°lisis predictivo, reportes anuais de cierre com comparativos hist√≥ricos. Para cada reporte especifica: fuentes de datos autom√°ticas (ERP, CRM, etc.), algoritmos de consolidaci√≥n, valida√ß√µes de calidad de datos, formato de presentaci√≥n, lista de distribuci√≥n autom√°tica en [nombre de √°rea/departamento], triggers para reportes especiales por excepci√≥n, y proceso de escalamiento para anomal√≠as detectadas."
            }
          ]
        }
      ]
    },
    {
      "title": "‚öñÔ∏è Cumplimiento Fiscal Proactivo",
      "icon": "üìã",
      "subcategories": [
        {
          "title": "Calendarios Fiscales",
          "prompts": [
            {
              "title": "Calendario Fiscal Integral Automatizado",
              "prompt": "Desarrolla un calendario fiscal completo que incluya todas las obriga√ß√µes tributarias nacionais, regionales y municipales aplicables a [tipo de empresa/sector], organizando: fechas de vencimiento mensuais, bimestrales, trimestrales y anuais, obriga√ß√µes diferenciadas por r√©gimen tributario (com√∫n, simplificado, especial), alertas autom√°ticas com [n√∫mero] d√≠as de anticipaci√≥n, categorizaci√≥n por tipo de impuesto (renta, IVA, industria y comercio, reten√ß√µes, parafiscales), indicaci√≥n de formularios y anexos requeridos, valor estimado de cada obligaci√≥n, responsable interno asignado en [nombre de √°rea/departamento], y status de cumplimiento. Incluye funcionalidad para actualizaci√≥n autom√°tica por cambios normativos y sincronizaci√≥n com sistema contable."
            }
          ]
        },
        {
          "title": "An√°lisis de Cambios Normativos",
          "prompts": [
            {
              "title": "An√°lisis Integral de Reforma Tributaria",
              "prompt": "Desarrolla un an√°lisis comprehensivo de [nova reforma tributaria/cambio normativo] que incluya: resumen ejecutivo de los cambios m√°s relevantes para nuestro tipo de empresa [tipo de empresa/sector], comparativo detallado entre normativa anterior vs. nova, an√°lisis cuantitativo del impacto en carga tributaria anual, identificaci√≥n de novas obriga√ß√µes y fechas de implementaci√≥n, oportunidades de planificaci√≥n fiscal emergentes, riscos de cumplimiento y √°reas de incertidumbre jur√≠dica, recomenda√ß√µes de a√ß√µes inmediatas vs. mediano plazo, an√°lisis de precedentes administrativos y doctrinarios disponibles, cronograma de implementaci√≥n por fases, y estrategia de comunicaci√≥n a stakeholders internos."
            }
          ]
        }
      ]
    },
    {
      "title": "üîç Auditor√≠a y Control Robusto",
      "icon": "üîé",
      "subcategories": [
        {
          "title": "Programas de Auditor√≠a",
          "prompts": [
            {
              "title": "Dise√±o de Programa Integral de Auditor√≠a",
              "prompt": "Act√∫a como auditor senior certificado (CIA/CPA) com experiencia en [sector espec√≠fico]. Dise√±a un programa de auditor√≠a integral para evaluar [proceso/√°rea espec√≠fica] que incluya: (a) An√°lisis detallado del entorno regulatorio aplicable (normas locais, internacionais, sectoriais), (b) Matriz de riscos estratificada por probabilidad e impacto com metodolog√≠a cualitativa y cuantitativa, (c) Objetivos espec√≠ficos SMART alineados com el apetito de risco organizacional, (d) Procedimientos sustantivos y de cumplimiento com t√©cnicas de muestreo estad√≠stico (MUS, estratificado, sistem√°tico), (e) Cronograma detallado com hitos cr√≠ticos y dependencias, (f) Asignaci√≥n de recursos humanos por nivel de experiencia y especializaci√≥n, (g) Presupuesto detallado com an√°lisis de sensibilidad (estimado de [monto/cantidad]), (h) Metodolog√≠a de documentaci√≥n seg√∫n est√°ndares internacionais (IIA, AICPA), (i) Indicadores de calidad y efectividad del programa, (j) Plan de contingencia para riscos identificados durante la ejecuci√≥n."
            }
          ]
        },
        {
          "title": "Evaluaci√≥n de Controles",
          "prompts": [
            {
              "title": "Evaluaci√≥n COSO Avanzada",
              "prompt": "Conduce una evaluaci√≥n exhaustiva del sistema de control interno aplicando COSO 2013 com enfoque en los 17 principios fundamentales para [√°rea/departamento]. Para cada componente: Ambiente de Control: (a) Evaluaci√≥n de tone at the top mediante an√°lisis de comunica√ß√µes ejecutivas, decis√µes √©ticas documentadas y cultura organizacional, (b) Assessment de estructura organizacional, l√≠neas de reporte y accountability framework, (c) Revisi√≥n de pol√≠ticas de RRHH, competencias profissionais y evaluaci√≥n de desempe√±o, Evaluaci√≥n de Riesgos: (d) An√°lisis de proceso de identificaci√≥n de riscos (talleres, entrevistas, an√°lisis de escenarios), (e) Evaluaci√≥n de metodolog√≠a de assessment de riscos com matrices probabilidad/impacto calibradas, (f) Revisi√≥n de proceso de respuesta al risco y definici√≥n de tolerancia, Atividades de Control: (g) Evaluaci√≥n de controles preventivos, detectivos y compensatorios com testing de efectividad operativa, (h) An√°lisis de segregaci√≥n de funciones en [proceso espec√≠fico] y controles de autorizaci√≥n, (i) Revisi√≥n de controles sobre procesamiento de informaci√≥n y reportes financeiros, Informaci√≥n y Comunicaci√≥n: (j) Assessment de calidad y relevancia de informaci√≥n para toma de decis√µes, (k) Evaluaci√≥n de efectividad de canales de comunicaci√≥n internos y externos, Monitoreo: (l) Revisi√≥n de atividades de monitoreo continuo y avalia√ß√µes separadas, (m) Assessment de proceso de reporte de deficiencias y seguimiento de a√ß√µes correctivas."
            }
          ]
        }
      ]
    }
  ];

  // ========================================================
  // === 3. L√ìGICA DE NAVEGACI√ìN DE PESTA√ëAS ================
  // ========================================================
  
  const tabGenerator = document.getElementById("tab-generator");
  const tabLibrary = document.getElementById("tab-library");
  const assistantView = document.getElementById("assistant-view");
  const libraryView = document.getElementById("library-view");

  tabGenerator.addEventListener("click", () => {
    tabGenerator.classList.add("active");
    tabLibrary.classList.remove("active");
    assistantView.classList.add("active");
    libraryView.classList.remove("active");
  });

  tabLibrary.addEventListener("click", () => {
    tabLibrary.classList.add("active");
    tabGenerator.classList.remove("active");
    libraryView.classList.add("active");
    assistantView.classList.remove("active");
  });

  // ========================================================
  // === L√ìGICA DEL GENERADOR (continuaci√≥n) ================
  // ========================================================

  const catPro = document.getElementById('cat-pro');
  const subcatPro = document.getElementById('subcat-pro');
  const taskPro = document.getElementById('task-pro');
  const templatePreview = document.getElementById('prompt-template-preview');
  const dynamicInputsContainer = document.getElementById('dynamic-inputs-container');
  const generateBtn = document.getElementById('generate-pro');
  const outputConsole = document.getElementById('output-console');
  const copyBtn = document.getElementById('copy-pro');
  const executionBtnContainer = document.getElementById('execution-btn-container');

  let currentPromptText = '';

  promptsData.forEach((cat, idx) => {
    const opt = document.createElement('option');
    opt.value = idx;
    opt.textContent = cat.title;
    catPro.appendChild(opt);
  });

  catPro.addEventListener('change', () => {
    const catIdx = catPro.value;
    subcatPro.innerHTML = '<option value="">Selecciona una subcategor√≠a...</option>';
    taskPro.innerHTML = '<option value="">Selecciona un prompt...</option>';
    templatePreview.textContent = 'Selecciona una subcategor√≠a primero...';
    dynamicInputsContainer.innerHTML = '';
    outputConsole.innerHTML = '';
    copyBtn.style.display = 'none';
    executionBtnContainer.style.display = 'none';
    currentPromptText = '';

    if (catIdx !== '') {
      const subs = promptsData[catIdx].subcategories;
      subs.forEach((sub, subIdx) => {
        const opt = document.createElement('option');
        opt.value = subIdx;
        opt.textContent = sub.title;
        subcatPro.appendChild(opt);
      });
    }
  });

  subcatPro.addEventListener('change', () => {
    const catIdx = catPro.value;
    const subIdx = subcatPro.value;
    taskPro.innerHTML = '<option value="">Selecciona un prompt...</option>';
    templatePreview.textContent = 'Selecciona un prompt...';
    dynamicInputsContainer.innerHTML = '';
    outputConsole.innerHTML = '';
    copyBtn.style.display = 'none';
    executionBtnContainer.style.display = 'none';
    currentPromptText = '';

    if (catIdx !== '' && subIdx !== '') {
      const tasks = promptsData[catIdx].subcategories[subIdx].prompts;
      tasks.forEach((t, tIdx) => {
        const opt = document.createElement('option');
        opt.value = tIdx;
        opt.textContent = t.title;
        taskPro.appendChild(opt);
      });
    }
  });

  taskPro.addEventListener('change', () => {
    const catIdx = catPro.value;
    const subIdx = subcatPro.value;
    const taskIdx = taskPro.value;

    dynamicInputsContainer.innerHTML = '';
    outputConsole.innerHTML = '';
    copyBtn.style.display = 'none';
    executionBtnContainer.style.display = 'none';
    currentPromptText = '';

    if (catIdx !== '' && subIdx !== '' && taskIdx !== '') {
      const theTask = promptsData[catIdx].subcategories[subIdx].prompts[taskIdx];
      const rawPrompt = theTask.prompt;

      const highlighted = rawPrompt.replace(/\[([^\]]+)\]/g, '<span class="bracket-content">[$1]</span>');
      templatePreview.innerHTML = highlighted;

      const bracketsRaw = rawPrompt.match(/\[([^\]]+)\]/g) || [];
      const uniqueBrackets = [...new Set(bracketsRaw)];

      if (uniqueBrackets.length > 0) {
        uniqueBrackets.forEach(b => {
          const cleanLabel = b.replace(/\[|\]/g, '');
          const group = document.createElement('div');
          group.className = 'dynamic-input-group';

          const label = document.createElement('label');
          label.textContent = cleanLabel;
          const inp = document.createElement('input');
          inp.type = 'text';
          inp.dataset.bracket = b;
          inp.placeholder = `Ingresa ${cleanLabel}`;

          group.appendChild(label);
          group.appendChild(inp);
          dynamicInputsContainer.appendChild(group);
        });
      }
    } else {
      templatePreview.textContent = 'Selecciona una tarea para ver la plantilla...';
    }
  });

  generateBtn.addEventListener('click', () => {
    const catIdx = catPro.value;
    const subIdx = subcatPro.value;
    const taskIdx = taskPro.value;

    if (catIdx === '' || subIdx === '' || taskIdx === '') {
      outputConsole.innerHTML = '<div class="output-error">Por favor, completa la selecci√≥n de categor√≠a, subcategor√≠a y tarea.</div>';
      copyBtn.style.display = 'none';
      executionBtnContainer.style.display = 'none';
      currentPromptText = '';
      return;
    }

    const theTask = promptsData[catIdx].subcategories[subIdx].prompts[taskIdx];
    let finalPrompt = theTask.prompt;

    const inputs = dynamicInputsContainer.querySelectorAll('input[data-bracket]');
    let allFilled = true;
    inputs.forEach(inp => {
      const val = inp.value.trim();
      if (!val) {
        allFilled = false;
      }
      const bracketPattern = inp.dataset.bracket.replace(/\[/g, '\\[').replace(/\]/g, '\\]');
      const regex = new RegExp(bracketPattern, 'g');
      finalPrompt = finalPrompt.replace(regex, val);
    });

    if (!allFilled) {
      outputConsole.innerHTML = '<div class="output-error">Por favor, completa todos los campos personalizables antes de generar.</div>';
      copyBtn.style.display = 'none';
      executionBtnContainer.style.display = 'none';
      currentPromptText = '';
      return;
    }

    currentPromptText = finalPrompt;
    outputConsole.innerHTML = `
      <div class="output-section">
        <strong class="output-title">Prompt Generado:</strong>
        <div class="output-content">${finalPrompt}</div>
      </div>
    `;
    copyBtn.style.display = 'inline-block';
    executionBtnContainer.style.display = 'grid';
  });

  copyBtn.addEventListener('click', () => {
    if (currentPromptText) {
      navigator.clipboard.writeText(currentPromptText).then(() => {
        alert('‚úÖ Prompt copiado al portapapeles');
      }).catch(err => {
        console.error('Error al copiar:', err);
        alert('‚ùå No se pudo copiar el prompt');
      });
    }
  });

  document.getElementById('exec-claude').addEventListener('click', () => {
    if (currentPromptText) {
      const encoded = encodeURIComponent(currentPromptText);
      window.open(`https://claude.ai/new?q=${encoded}`, '_blank');
    }
  });

  document.getElementById('exec-chatgpt').addEventListener('click', () => {
    if (currentPromptText) {
      const encoded = encodeURIComponent(currentPromptText);
      window.open(`https://chat.openai.com/?q=${encoded}`, '_blank');
    }
  });

  document.getElementById('exec-gemini').addEventListener('click', () => {
    if (currentPromptText) {
      const encoded = encodeURIComponent(currentPromptText);
      window.open(`https://gemini.google.com/app?q=${encoded}`, '_blank');
    }
  });

  applyFiltersAndSearch();

});
  </script>
</body>
</html>
